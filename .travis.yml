os: linux
language: python
#python:
#- 2.6
#- 2.7
#- 3.4
#- 3.5
#- 3.6
#- pypy
#- pypy3
addons:
  apt:
    packages:
    - libmediainfo-dev
matrix:
  include:
#    - python: 3.7
#      dist: xenial
#      # TODO: remove this hack once it's not required any more
#      sudo: true
    - os: osx
      # Not required but makes Travis' output prettier
      python: 2.7
      language: generic
      env: MB_PYTHON_VERSION=2.7
    - os: osx
      python: 3.4
      language: generic
      env: MB_PYTHON_VERSION=3.4
    - os: osx
      python: 3.5
      language: generic
      env: MB_PYTHON_VERSION=3.5
    - os: osx
      python: 3.6
      language: generic
      env: MB_PYTHON_VERSION=3.6
    - os: osx
      python: 3.7
      language: generic
      env: MB_PYTHON_VERSION=3.7
before_install: |
  if [ $TRAVIS_OS_NAME == osx ]; then
    git clone https://github.com/matthew-brett/multibuild
    touch config.sh # required by the multibuild project
    source multibuild/common_utils.sh
    source multibuild/travis_steps.sh
    before_install
    curl https://mediaarea.net/download/binary/libmediainfo0/18.08.1/MediaInfo_DLL_18.08.1_Mac_i386+x86_64.tar.bz2 | tar xj
    mv MediaInfoLib/libmediainfo.*dylib pymediainfo
    mv MediaInfoLib/License.html docs
  fi
  pip install pytest pytest-runner setuptools_scm
script: |
  python setup.py test
notifications:
  email:
    on_success: change
    on_failure: change
after_success: |
  if [[ $TRAVIS_OS_NAME == osx && $TRAVIS_BRANCH == wheel && $MB_PYTHON_VERSION == 3.7 ]]; then
    python setup.py sdist
    python setup.py bdist_wheel
    pip install twine
    twine upload --repository-url https://test.pypi.org/legacy/ -u sbraz -p $PYPI_PASSWORD dist/*
  fi
env:
  global:
    # PYPI_PASSWORD
    secure: "BxnZeOAKTELq77Ut4d4g4ilEG7TfPHiXQ4OG0f/avdHpU0ngS8o7BYOYOrlYLBeT0utzTan7YK3l1ezYYaz4s6LWjxl1kJrOxkgo6qHlMGXRiDAV/eeunPdwQ93kZRyG4R8BUlqigp82J6zjs9SOCvkRZwKE4tyWmirKj59bkhM="
